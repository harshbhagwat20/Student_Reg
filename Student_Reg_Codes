import tkinter as tk
from tkinter import messagebox
import mysql.connector

# Connect to MySQL
try:
    conn = mysql.connector.connect(
        host="localhost",
        user="root",  # Replace with your MySQL username
        password="Harsh@1100",  # Replace with your MySQL password
        database="student_db"
    )
    cursor = conn.cursor()
except mysql.connector.Error as err:
    messagebox.showerror("Database Error", f"Failed to connect: {err}")
    raise SystemExit

# Submit function
def submit():
    name = name_entry.get().strip()
    age = age_entry.get().strip()
    gender = gender_var.get()
    email = email_entry.get().strip()

    # Basic validation
    if not name or not age or not email:
        messagebox.showerror("Input Error", "Please fill out all required fields.")
        return

    if not age.isdigit():
        messagebox.showerror("Input Error", "Age must be a number.")
        return

    try:
        cursor.execute(
            "INSERT INTO students (name, age, gender, email) VALUES (%s, %s, %s, %s)",
            (name, int(age), gender, email)
        )
        conn.commit()
        messagebox.showinfo("Success", "Student registered successfully!")
        name_entry.delete(0, tk.END)
        age_entry.delete(0, tk.END)
        email_entry.delete(0, tk.END)
    except mysql.connector.Error as err:
        messagebox.showerror("Database Error", f"Failed to insert: {err}")

# Build GUI
root = tk.Tk()
root.title("Student Registration")

tk.Label(root, text="Name:").grid(row=0, column=0, padx=10, pady=5)
name_entry = tk.Entry(root)
name_entry.grid(row=0, column=1, padx=10, pady=5)

tk.Label(root, text="Age:").grid(row=1, column=0, padx=10, pady=5)
age_entry = tk.Entry(root)
age_entry.grid(row=1, column=1, padx=10, pady=5)

tk.Label(root, text="Gender:").grid(row=2, column=0, padx=10, pady=5)
gender_var = tk.StringVar(value="Male")
tk.OptionMenu(root, gender_var, "Male", "Female", "Other").grid(row=2, column=1, padx=10, pady=5)

tk.Label(root, text="Email:").grid(row=3, column=0, padx=10, pady=5)
email_entry = tk.Entry(root)
email_entry.grid(row=3, column=1, padx=10, pady=5)

tk.Button(root, text="Submit", command=submit).grid(row=4, column=1, pady=10)

# Graceful exit (close DB on window close)
def on_close():
    cursor.close()
    conn.close()
    root.destroy()

root.protocol("WM_DELETE_WINDOW", on_close)
root.mainloop()
